tinymce.PluginManager.add("jdragdrop",function(i){function d(e){var t=new FormData;t.append("Filedata",e),t.append("folder",tinyMCE.activeEditor.settings.mediaUploadPath);var n=new XMLHttpRequest;n.upload.onprogress=function(e){var t=e.loaded/e.total*100;document.querySelector(".bar").style.width=t+"%"};function r(){setTimeout(function(){var e=document.querySelector("#jloader");e.parentNode.removeChild(e),i.contentAreaContainer.style.borderWidth="1px 0 0 0"},200)}n.onload=function(){var e=JSON.parse(n.responseText);if(200==n.status){if("0"==e.status&&(r(),i.windowManager.alert(e.message+": "+tinyMCE.activeEditor.settings.setCustomDir+e.location)),"1"==e.status){r();var t=tinyMCE.activeEditor.getDoc().createElement("img");t.src=tinyMCE.activeEditor.settings.setCustomDir+e.location,t.setAttribute("loading","lazy"),tinyMCE.activeEditor.execCommand("mceInsertContent",!1,t.outerHTML)}}else r()},n.onerror=function(){r()},n.open("POST",tinyMCE.activeEditor.settings.uploadUri,!0),n.send(t)}tinyMCE.DOM.bind(document,"dragleave",function(e){return e.stopPropagation(),e.preventDefault(),!(tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="1px 0 0")}),"undefined"!=typeof FormData?(i.on("dragenter",function(e){return e.stopPropagation(),!1}),i.on("dragover",function(e){return e.preventDefault(),i.contentAreaContainer.style.borderStyle="dashed",!(i.contentAreaContainer.style.borderWidth="5px")}),i.on("drop",function(e){if(e.dataTransfer&&e.dataTransfer.files&&0<e.dataTransfer.files.length)for(var t,n=0;t=e.dataTransfer.files[n];n++){if(t.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)){var r,a,o="";(r=document.createElement("div")).id="jloader",(a=document.createElement("div")).classList.add("progress"),a.classList.add("progress-success"),a.classList.add("progress-striped"),a.classList.add("active"),a.style.width="100%",a.style.height="30px",(o=document.createElement("div")).classList.add("bar"),o.style.width="0",a.appendChild(o),r.appendChild(a),document.querySelector(".mce-toolbar-grp").appendChild(r),d(t)}e.preventDefault()}i.contentAreaContainer.style.borderWidth="1px 0 0"})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),i.on("drop",function(e){return e.preventDefault(),!1}))});